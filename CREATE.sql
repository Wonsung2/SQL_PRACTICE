CREATE TABLE CUSTOMERS(
    CNO NUMBER(5) PRIMARY KEY,
    CNAME VARCHAR2(10) NOT NULL,
    ADDRESS VARCHAR2(50) NOT NULL,
    EMAIL VARCHAR2(20) NOT NULL,
    PHONE VARCHAR2(20) NOT NULL
);
-- DROP TABLE ORDERS;
CREATE TABLE ORDERS(
    ORDERNO NUMBER(10) PRIMARY KEY,
    ORDERDATE DATE DEFAULT SYSDATE NOT NULL,
    ADDRESS VARCHAR2(50) NOT NULL,
    PHONE VARCHAR2(20) NOT NULL,
    STATUS VARCHAR2(20) NOT NULL,
    CNO NUMBER(5) NOT NULL,
    CHECK (STATUS IN ('결제완료', '배송중', '배송완료')),
    FOREIGN KEY (CNO) REFERENCES CUSTOMERS(CNO)
);

CREATE TABLE PRODUCTS(
    PNO NUMBER(5) PRIMARY KEY,
    PNAME VARCHAR(20) NOT NULL,
    COST NUMBER(8) DEFAULT 0 NOT NULL,
    STOCK NUMBER(5) DEFAULT 0 NOT NULL
);

CREATE TABLE ORDERDETAIL(
    ORDERNO NUMBER(10),
    PNO NUMBER(5),
    QTY NUMBER(5),
    COST NUMBER(8),
    PRIMARY KEY(ORDERNO, PNO),
    FOREIGN KEY (ORDERNO) REFERENCES ORDERS(ORDERNO),
    FOREIGN KEY (PNO) REFERENCES PRODUCTS(PNO)
);

INSERT INTO PRODUCTS VALUES(1001, '삼양라면', 1000, 200);
INSERT INTO PRODUCTS VALUES(1002, '새우깡', 1500, 500);
INSERT INTO PRODUCTS VALUES(1003, '월드콘', 2000, 350);
INSERT INTO PRODUCTS VALUES(1004, '빼빼로', 2000, 700);
INSERT INTO PRODUCTS VALUES(1005, '코카콜라', 1800, 550);
INSERT INTO PRODUCTS VALUES(1006, '환타', 1600, 300);

INSERT INTO CUSTOMERS VALUES(101, '김철수', '서울 강남구', 'CSKIM@NASVER.COM','899-6666');
INSERT INTO CUSTOMERS VALUES(102, '이영희', '부산 서면', 'YHLEE@EMPAL.COM','355-8882');
INSERT INTO CUSTOMERS VALUES(103, '최진국', '제주 동광양', 'JKCHOI@GMAIL.COM','852-5764');
INSERT INTO CUSTOMERS VALUES(104, '강준호', '강릉 홍제동', 'JHKANG@HANMAIL.COM','559-7777');
INSERT INTO CUSTOMERS VALUES(105, '민병국', '대구 전민동', 'BGMIN@HOTMAIL.COM','559-8741');
INSERT INTO CUSTOMERS VALUES(106, '오민수', '광주 북구', 'MSOH@MICROSOFT.COM','542-9988');

SELECT *
FROM PRODUCTS;
SELECT *
FROM CUSTOMERS;

SELECT CNO
FROM CUSTOMERS
WHERE CNAME = '김철수';

SELECT *
FROM ORDERS;

INSERT INTO ORDERS VALUES('1', SYSDATE-3, '서을 강남구', '869-6666', '결제완료', '101');
SELECT *
FROM ORDERS;
SELECT *
FROM ORDERDETAIL;

INSERT INTO ORDERDETAIL VALUES('1', '1001', '50', '1000');

SELECT *
FROM ORDERDETAIL;

SELECT *
FROM PRODUCTS;

UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1001') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1001')
WHERE PNO = '1001';

SELECT CNO
FROM CUSTOMERS
WHERE CNAME = '이영희';
INSERT INTO ORDERS VALUES('2', SYSDATE-2, '부산 수영구', '337-5000', '결제완료', '102');
INSERT INTO ORDERDETAIL VALUES('2', '1002', '100', '1500');
INSERT INTO ORDERDETAIL VALUES('2', '1003', '150', '2000');

UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1002') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1002')
WHERE PNO = '1002';
UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1003') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1003')
WHERE PNO = '1003';

SELECT *
FROM PRODUCTS;

SELECT CNO
FROM CUSTOMERS
WHERE CNAME = '오민수';
INSERT INTO ORDERS VALUES('3', SYSDATE-1, '광주 북구', '652-2277', '결제완료', '106');
INSERT INTO ORDERDETAIL VALUES('3', '1004', '100', '2000');
INSERT INTO ORDERDETAIL VALUES('3', '1005', '50', '1800');

UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1004') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1004')
WHERE PNO = '1004';
UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1005') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1005')
WHERE PNO = '1005';

SELECT *
FROM PRODUCTS;
SELECT *
     FROM ORDERS A
     LEFT JOIN ORDERDETAIL O ON ( O.ORDERNO = A.ORDERNO)
     LEFT JOIN CUSTOMERS C ON ( A.CNO = C.CNO) 
     LEFT JOIN PRODUCTS P ON ( O.PNO = P.PNO );


SELECT ORDERDATE, CNAME, ADDRESS, PHONE, STATUS
FROM ORDERS O
JOIN CUSTOMERS C ON ( O.CNO = C.CNO);
UNION
SELECT PNAME, COST, QYT, COST*QTY
FROM ORDERDETAIL D
JOIN PRODUCTS P ON ( D.PNO = P.PNO );






SELECT ORDERDATE, SUM(COST*QTY)
FROM( SELECT *
      FROM ORDERS
      JOIN ORDERDETAIL USING(ORDERNO))
GROUP BY ORDERDATE
ORDER BY 1;

SELECT *
FROM PRODUCTS;
INSERT INTO PRODUCTS VALUES('1007', '목캔디', '3000', '500');

SELECT CNO
FROM CUSTOMERS
WHERE CNAME = '최진국';
INSERT INTO ORDERS VALUES('4', SYSDATE, '제주 동광양', '352-4657', '결제완료', '103');
INSERT INTO ORDERDETAIL VALUES('4', '1007', '200', '3000');
UPDATE PRODUCTS 
SET STOCK = (SELECT STOCK FROM PRODUCTS WHERE PNO = '1007') - (SELECT QTY FROM ORDERDETAIL WHERE PNO = '1007')
WHERE PNO = '1007';